<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podaż Pieniądza w Polsce</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f7fa;
            margin: 0;
            padding: 0;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        h1, h2 {
            text-align: center;
            color: #1a3c5e;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 50px;
        }
        h2 {
            font-size: 2rem;
            margin: 40px 0 30px;
        }
        .columns {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .column-container {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
        }
        .column {
            background: linear-gradient(135deg, #ffffff, #e8eff5);
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
            transition: transform 0.3s ease;
            border-top: 5px solid transparent;
        }
        .m3-column {
            border-top-color: #9f7aea;
        }
        .m2-column {
            border-top-color: #4299e1;
        }
        .m1-column {
            border-top-color: #48bb78;
        }
        .column:hover {
            transform: translateY(-5px);
        }
        .column h2 {
            font-size: 3.5rem;
            font-weight: 700;
            margin: 0 0 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.15);
            display: inline-block;
        }
        .m3-header {
            background: linear-gradient(135deg, #6b46c1, #9f7aea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .m2-header {
            background: linear-gradient(135deg, #2b6cb0, #4299e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .m1-header {
            background: linear-gradient(135deg, #2f855a, #48bb78);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .value {
            font-size: 2rem;
            font-weight: 600;
            color: #2c5282;
            margin: 10px 0;
        }
        .change {
            font-size: 1.1rem;
            margin: 5px 0;
        }
        .positive {
            color: #28a745;
        }
        .negative {
            color: #dc3545;
        }
        .date-info {
            font-size: 0.8rem;
            color: #666;
            margin-top: 10px;
        }
        .text-box {
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-top: 20px;
            text-align: left;
        }
        .text-content {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .charts-section {
            margin-top: 60px;
        }
        .chart-columns {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        .chart-column {
            flex: 1;
            min-width: 300px;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        .toggles {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toggle-label {
            font-size: 0.9rem;
            color: #333;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 20px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #4299e1;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        #brush-chart-values, #brush-chart-changes {
            margin-top: -10px;
            margin-bottom: 20px;
        }
        .apexcharts-selection-rect, 
        .apexcharts-svg rect.apexcharts-zoom-rect, 
        .apexcharts-svg rect.apexcharts-selection-rect {
            cursor: move;
        }
        /* Większe uchwyty na urządzeniach mobilnych */
        @media (max-width: 768px) {
            .apexcharts-zoom-icon,
            .apexcharts-selection-icon,
            .apexcharts-reset-icon {
                transform: scale(1.5);
                margin: 0 5px;
            }
            #brush-chart-values, #brush-chart-changes {
                height: 160px !important;
            }
            .apexcharts-selection-rect .apexcharts-selection-rect-handle {
                width: 20px !important;
                height: 20px !important;
                transform: translate(-50%, -50%);
            }
        }
        .time-range-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        .time-range-buttons button {
            padding: 8px 12px;
            background-color: #f0f5fa;
            border: 1px solid #d1d9e2;
            border-radius: 10px;
            color: #333;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .time-range-buttons button:hover {
            background-color: #e0ebf5;
        }
        .time-range-buttons button.active {
            background-color: #4299e1;
            color: white;
            border-color: #3182ce;
        }
        @media (max-width: 768px) {
            .columns, .chart-columns {
                flex-direction: column;
                align-items: center;
            }
            .column-container, .chart-column {
                width: 100%;
                max-width: 400px;
            }
            .toggles {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Podaż Pieniądza w Polsce</h1>
        <div class="columns">
            <div class="column-container">
                <div class="column m3-column">
                    <h2 class="m3-header">M3</h2>
                    <div class="value" id="m3-value">Ładowanie...</div>
                    <div class="change" id="m3-mm">Ładowanie...</div>
                    <div class="change" id="m3-rr">Ładowanie...</div>
                    <div class="date-info" id="m3-date">Ładowanie...</div>
                </div>
                <div class="text-box">
                    <div class="text-content" id="m3-text">
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                    </div>
                </div>
            </div>
            <div class="column-container">
                <div class="column m2-column">
                    <h2 class="m2-header">M2</h2>
                    <div class="value" id="m2-value">Ładowanie...</div>
                    <div class="change" id="m2-mm">Ładowanie...</div>
                    <div class="change" id="m2-rr">Ładowanie...</div>
                    <div class="date-info" id="m2-date">Ładowanie...</div>
                </div>
                <div class="text-box">
                    <div class="text-content" id="m2-text">
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                    </div>
                </div>
            </div>
            <div class="column-container">
                <div class="column m1-column">
                    <h2 class="m1-header">M1</h2>
                    <div class="value" id="m1-value">Ładowanie...</div>
                    <div class="change" id="m1-mm">Ładowanie...</div>
                    <div class="change" id="m1-rr">Ładowanie...</div>
                    <div class="date-info" id="m1-date">Ładowanie...</div>
                </div>
                <div class="text-box">
                    <div class="text-content" id="m1-text">
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                    </div>
                </div>
            </div>
        </div>
        <section class="charts-section">
            <h2>Wykres skumulowany</h2>
            <div class="chart-columns">
                <div class="chart-column">
                    <div id="values-chart"></div>
                    <div id="brush-chart-values"></div>
                </div>
                <div class="chart-column">
                    <div class="toggles">
                        <div class="toggle-container">
                            <span class="toggle-label">r/r</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="period-toggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-label">m/m</span>
                        </div>
                        <div class="toggle-container">
                            <span class="toggle-label">mld PLN</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="unit-toggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span class="toggle-label">%</span>
                        </div>
                    </div>
                    <div id="changes-chart"></div>
                    <div id="brush-chart-changes"></div>
                </div>
            </div>
        </section>
    </div>
    <script>
        function isMobileDevice() {
            return window.innerWidth <= 768;
        }

        async function loadData() {
            try {
                const response = await fetch('am_data.json');
                if (!response.ok) throw new Error('Nie udało się załadować pliku JSON');
                const jsonData = await response.json();

                const columns = {
                    m3: jsonData.columns.find(col => col.column_id === 23),
                    m2: jsonData.columns.find(col => col.column_id === 19),
                    m1: jsonData.columns.find(col => col.column_id === 11)
                };

                // Przetwarzanie danych dla ramek
                for (const [key, column] of Object.entries(columns)) {
                    if (!column) {
                        document.getElementById(`${key}-value`).textContent = 'Brak danych';
                        document.getElementById(`${key}-mm`).textContent = 'Brak danych';
                        document.getElementById(`${key}-rr`).textContent = 'Brak danych';
                        document.getElementById(`${key}-date`).textContent = 'Brak danych';
                        document.getElementById(`${key}-text`).textContent = `Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.`;
                        continue;
                    }

                    const data = column.data;
                    const latest = data[data.length - 1];
                    const latestValue = latest.value / 1000;
                    const latestDate = new Date(latest.date);

                    const prevMonthDate = new Date(latestDate);
                    prevMonthDate.setMonth(prevMonthDate.getMonth() - 1);
                    const prevMonthStr = prevMonthDate.toISOString().slice(0, 10);
                    const prevMonthEntry = data.find(entry => entry.date.slice(0, 7) === prevMonthStr.slice(0, 7));
                    const prevMonthValue = prevMonthEntry ? prevMonthEntry.value / 1000 : null;

                    const prevYearDate = new Date(latestDate);
                    prevYearDate.setFullYear(prevYearDate.getFullYear() - 1);
                    const prevYearStr = prevYearDate.toISOString().slice(0, 10);
                    const prevYearEntry = data.find(entry => entry.date.slice(0, 7) === prevYearStr.slice(0, 7));
                    const prevYearValue = prevYearEntry ? prevYearEntry.value / 1000 : null;

                    let mmChange = null, mmPercent = null, rrChange = null, rrPercent = null;
                    if (prevMonthValue !== null) {
                        mmChange = latestValue - prevMonthValue;
                        mmPercent = (mmChange / prevMonthValue) * 100;
                    }
                    if (prevYearValue !== null) {
                        rrChange = latestValue - prevYearValue;
                        rrPercent = (rrChange / prevYearValue) * 100;
                    }

                    document.getElementById(`${key}-value`).textContent = `${latestValue.toFixed(2)} mld PLN`;
                    document.getElementById(`${key}-mm`).textContent = prevMonthValue !== null
                        ? `${mmChange >= 0 ? '+' : ''}${mmChange.toFixed(2)} mld m/m (${mmPercent.toFixed(2)}%)`
                        : 'Brak danych m/m';
                    document.getElementById(`${key}-mm`).className = `change ${mmChange >= 0 ? 'positive' : 'negative'}`;
                    document.getElementById(`${key}-rr`).textContent = prevYearValue !== null
                        ? `${rrChange >= 0 ? '+' : ''}${rrChange.toFixed(2)} mld r/r (${rrPercent.toFixed(2)}%)`
                        : 'Brak danych r/r';
                    document.getElementById(`${key}-rr`).className = `change ${rrChange >= 0 ? 'positive' : 'negative'}`;
                    document.getElementById(`${key}-date`).textContent = `Stan na ${latest.date}, źródło: NBP`;
                    document.getElementById(`${key}-text`).textContent = `Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.`;
                }

                // Przetwarzanie danych dla wykresów
                const dates = columns.m3 ? columns.m3.data.map(d => d.date) : [];
                const valuesData = {
                    m3: columns.m3 ? columns.m3.data.map(d => d.value / 1000) : [],
                    m2: columns.m2 ? columns.m2.data.map(d => d.value / 1000) : [],
                    m1: columns.m1 ? columns.m1.data.map(d => d.value / 1000) : []
                };

                // Oblicz zmiany dla wykresu zmian
                const calculateChanges = (period, unit) => {
                    const changes = { m3: [], m2: [], m1: [] };
                    for (const key of ['m3', 'm2', 'm1']) {
                        if (!columns[key]) {
                            changes[key] = new Array(dates.length).fill(null);
                            continue;
                        }
                        const data = columns[key].data;
                        for (let i = 0; i < data.length; i++) {
                            const currentDate = new Date(data[i].date);
                            const currentValue = data[i].value / 1000;
                            let prevValue = null;
                            if (period === 'rr') {
                                const prevYearDate = new Date(currentDate);
                                prevYearDate.setFullYear(prevYearDate.getFullYear() - 1);
                                const prevYearStr = prevYearDate.toISOString().slice(0, 10);
                                const prevEntry = data.find(entry => entry.date.slice(0, 7) === prevYearStr.slice(0, 7));
                                prevValue = prevEntry ? prevEntry.value / 1000 : null;
                            } else {
                                const prevMonthDate = new Date(currentDate);
                                prevMonthDate.setMonth(prevMonthDate.getMonth() - 1);
                                const prevMonthStr = prevMonthDate.toISOString().slice(0, 10);
                                const prevEntry = data.find(entry => entry.date.slice(0, 7) === prevMonthStr.slice(0, 7));
                                prevValue = prevEntry ? prevEntry.value / 1000 : null;
                            }
                            if (prevValue !== null) {
                                const change = currentValue - prevValue;
                                changes[key][i] = unit === 'percent' ? (change / prevValue * 100) : change;
                            } else {
                                changes[key][i] = null;
                            }
                        }
                    }
                    return changes;
                };

                // Wykres wartości
                const valuesChartOptions = {
                    chart: {
                        id: 'valueChart',
                        type: 'area',
                        height: 400,
                        fontFamily: 'Poppins, sans-serif',
                        zoom: {
                            enabled: false
                        },
                        toolbar: {
                            show: true,
                            tools: {
                                download: false,
                                selection: false,
                                zoom: false,
                                zoomin: false,
                                zoomout: false,
                                pan: false,
                                reset: true
                            }
                        }
                    },
                    series: [
                        { name: 'M3', data: valuesData.m3, color: '#9f7aea' },
                        { name: 'M2', data: valuesData.m2, color: '#4299e1' },
                        { name: 'M1', data: valuesData.m1, color: '#48bb78' }
                    ],
                    xaxis: {
                        type: 'datetime',
                        categories: dates,
                        labels: { format: 'yyyy-MM' }
                    },
                    yaxis: {
                        title: { text: 'Wartość (mld PLN)' },
                        labels: { formatter: val => val.toFixed(2) },
                        forceNiceScale: true
                    },
                    stroke: {
                        curve: 'smooth',
                        width: 2
                    },
                    fill: {
                        opacity: 0.3,
                        type: 'gradient',
                        gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.7,
                            opacityTo: 0.2
                        }
                    },
                    dataLabels: {
                        enabled: false
                    },
                    markers: {
                        size: 0,
                        hover: {
                            size: 5
                        }
                    },
                    tooltip: {
                        x: { format: 'yyyy-MM-dd' },
                        y: { formatter: val => val ? `${val.toFixed(2)} mld PLN` : 'Brak danych' },
                        shared: true,
                        intersect: false
                    },
                    legend: {
                        position: 'top',
                        horizontalAlign: 'center'
                    }
                };

                const valuesBrushOptions = {
                    chart: {
                        id: 'brushChartValues',
                        height: 130,
                        type: 'area',
                        brush: {
                            enabled: true,
                            target: 'valueChart'
                        },
                        selection: {
                            enabled: true,
                            xaxis: {
                                min: dates.length > 120 ? new Date(dates[dates.length - 120]).getTime() : new Date(dates[0]).getTime(),
                                max: new Date(dates[dates.length - 1]).getTime()
                            }
                        }
                    },
                    colors: ['#9f7aea', '#4299e1', '#48bb78'],
                    series: [
                        { name: 'M3', data: valuesData.m3 },
                        { name: 'M2', data: valuesData.m2 },
                        { name: 'M1', data: valuesData.m1 }
                    ],
                    xaxis: {
                        type: 'datetime',
                        categories: dates,
                        labels: { format: 'yyyy-MM' },
                        tooltip: {
                            enabled: false
                        }
                    },
                    yaxis: {
                        tickAmount: 2,
                        labels: {
                            show: false
                        }
                    },
                    legend: {
                        show: false
                    },
                    fill: {
                        opacity: 0.1
                    },
                    stroke: {
                        width: 1
                    }
                };

                const valuesChart = new ApexCharts(document.querySelector('#values-chart'), valuesChartOptions);
                valuesChart.render();

                const valuesBrushChart = new ApexCharts(document.querySelector('#brush-chart-values'), valuesBrushOptions);
                valuesBrushChart.render();

                // Wykres zmian
                let currentPeriod = 'rr';
                let currentUnit = 'mld';

                let changesChart = new ApexCharts(document.querySelector('#changes-chart'), {
                    chart: {
                        id: 'changesChart',
                        type: 'area',
                        height: 400,
                        fontFamily: 'Poppins, sans-serif',
                        zoom: {
                            enabled: false
                        },
                        toolbar: {
                            show: true,
                            tools: {
                                download: false,
                                selection: false,
                                zoom: false,
                                zoomin: false,
                                zoomout: false,
                                pan: false,
                                reset: true
                            }
                        }
                    },
                    series: [],
                    xaxis: {
                        type: 'datetime',
                        categories: dates,
                        labels: { format: 'yyyy-MM' }
                    },
                    stroke: { curve: 'smooth', width: 2 },
                    fill: {
                        opacity: 0.2,
                        type: 'gradient',
                        gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.5,
                            opacityTo: 0.1
                        }
                    },
                    dataLabels: {
                        enabled: false
                    },
                    markers: {
                        size: 0,
                        hover: {
                            size: 5
                        }
                    },
                    legend: { position: 'top' }
                });
                changesChart.render();

                const changesBrushOptions = {
                    chart: {
                        id: 'brushChartChanges',
                        height: 130,
                        type: 'area',
                        brush: {
                            enabled: true,
                            target: 'changesChart'
                        },
                        selection: {
                            enabled: true,
                            xaxis: {
                                min: dates.length > 120 ? new Date(dates[dates.length - 120]).getTime() : new Date(dates[0]).getTime(),
                                max: new Date(dates[dates.length - 1]).getTime()
                            }
                        }
                    },
                    colors: ['#9f7aea', '#4299e1', '#48bb78'],
                    series: [],
                    xaxis: {
                        type: 'datetime',
                        categories: dates,
                        labels: { format: 'yyyy-MM' },
                        tooltip: {
                            enabled: false
                        }
                    },
                    yaxis: {
                        tickAmount: 2,
                        labels: {
                            show: false
                        }
                    },
                    legend: {
                        show: false
                    },
                    fill: {
                        opacity: 0.1
                    },
                    stroke: {
                        width: 1
                    }
                };

                const changesBrushChart = new ApexCharts(document.querySelector('#brush-chart-changes'), changesBrushOptions);
                changesBrushChart.render();

                // Obsługa przycisków zakresu czasowego na urządzeniach mobilnych
                if (isMobileDevice()) {
                    document.getElementById('brush-chart-values').style.display = 'none';
                    document.getElementById('brush-chart-changes').style.display = 'none';
                    
                    const timeRanges = [
                        { label: '1 rok', value: 12 },
                        { label: '3 lata', value: 36 },
                        { label: '5 lat', value: 60 },
                        { label: '10 lat', value: 120 },
                        { label: 'wszystkie', value: 'all' }
                    ];
                    
                    const valuesButtonsContainer = document.createElement('div');
                    valuesButtonsContainer.className = 'time-range-buttons';
                    
                    timeRanges.forEach(range => {
                        const button = document.createElement('button');
                        button.textContent = range.label;
                        button.dataset.range = range.value;
                        if (range.value === 120) button.classList.add('active');
                        
                        button.addEventListener('click', () => {
                            valuesButtonsContainer.querySelectorAll('button').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            
                            button.classList.add('active');
                            
                            const rangeValue = button.dataset.range;
                            let minDate;
                            
                            if (rangeValue === 'all') {
                                minDate = new Date(dates[0]).getTime();
                            } else {
                                const months = parseInt(rangeValue);
                                const startIdx = Math.max(0, dates.length - months);
                                minDate = new Date(dates[startIdx]).getTime();
                            }
                            
                            const maxDate = new Date(dates[dates.length - 1]).getTime();
                            
                            valuesChart.updateOptions({
                                xaxis: {
                                    min: minDate,
                                    max: maxDate
                                }
                            });
                        });
                        
                        valuesButtonsContainer.appendChild(button);
                    });
                    
                    document.getElementById('values-chart').before(valuesButtonsContainer);
                    
                    const changesButtonsContainer = document.createElement('div');
                    changesButtonsContainer.className = 'time-range-buttons';
                    
                    timeRanges.forEach(range => {
                        const button = document.createElement('button');
                        button.textContent = range.label;
                        button.dataset.range = range.value;
                        if (range.value === 120) button.classList.add('active');
                        
                        button.addEventListener('click', () => {
                            changesButtonsContainer.querySelectorAll('button').forEach(btn => {
                                btn.classList.remove('active');
                            });
                            
                            button.classList.add('active');
                            
                            const rangeValue = button.dataset.range;
                            let minDate;
                            
                            if (rangeValue === 'all') {
                                minDate = new Date(dates[0]).getTime();
                            } else {
                                const months = parseInt(rangeValue);
                                const startIdx = Math.max(0, dates.length - months);
                                minDate = new Date(dates[startIdx]).getTime();
                            }
                            
                            const maxDate = new Date(dates[dates.length - 1]).getTime();
                            
                            changesChart.updateOptions({
                                xaxis: {
                                    min: minDate,
                                    max: maxDate
                                }
                            });
                        });
                        
                        changesButtonsContainer.appendChild(button);
                    });
                    
                    document.getElementById('changes-chart').before(changesButtonsContainer);
                }

                const updateChangesChart = () => {
                    const changes = calculateChanges(currentPeriod, currentUnit);
                    changesChart.updateSeries([
                        { name: 'M3', data: changes.m3, color: '#9f7aea' },
                        { name: 'M2', data: changes.m2, color: '#4299e1' },
                        { name: 'M1', data: changes.m1, color: '#48bb78' }
                    ]);
                    changesChart.updateOptions({
                        yaxis: {
                            title: { text: currentUnit === 'percent' ? 'Zmiana (%)' : 'Zmiana (mld PLN)' },
                            labels: { formatter: val => val ? val.toFixed(2) : '' },
                            forceNiceScale: true
                        },
                        tooltip: {
                            x: { format: 'yyyy-MM-dd' },
                            y: { formatter: val => val ? `${val.toFixed(2)} ${currentUnit === 'percent' ? '%' : 'mld PLN'}` : 'Brak danych' },
                            shared: true,
                            intersect: false
                        }
                    });
                    changesBrushChart.updateSeries([
                        { name: 'M3', data: changes.m3, color: '#9f7aea' },
                        { name: 'M2', data: changes.m2, color: '#4299e1' },
                        { name: 'M1', data: changes.m1, color: '#48bb78' }
                    ]);
                };

                updateChangesChart();

                document.getElementById('period-toggle').addEventListener('change', (e) => {
                    currentPeriod = e.target.checked ? 'rr' : 'mm';
                    updateChangesChart();
                });

                document.getElementById('unit-toggle').addEventListener('change', (e) => {
                    currentUnit = e.target.checked ? 'mld' : 'percent';
                    updateChangesChart();
                });
            } catch (error) {
                console.error('Błąd:', error);
                for (const key of ['m3', 'm2', 'm1']) {
                    document.getElementById(`${key}-value`).textContent = 'Błąd ładowania';
                    document.getElementById(`${key}-mm`).textContent = 'Błąd';
                    document.getElementById(`${key}-rr`).textContent = 'Błąd';
                    document.getElementById(`${key}-date`).textContent = 'Błąd';
                    document.getElementById(`${key}-text`).textContent = `Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.`;
                }
                document.querySelector('#values-chart').innerHTML = '<p>Błąd ładowania wykresu</p>';
                document.querySelector('#changes-chart').innerHTML = '<p>Błąd ładowania wykresu</p>';
                document.querySelector('#brush-chart-values').innerHTML = '';
                document.querySelector('#brush-chart-changes').innerHTML = '';
            }
        }

        window.onload = loadData;
    </script>
</body>
</html>
